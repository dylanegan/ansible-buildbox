description "buildbox-agent"
# buildbox-agent - The agent service for http://buildbox.io
#
# {{ ansible_managed }}
#
# buildbox-agent

env BUILDBOX_HOME={{ buildbox_home }}
env BUILDBOX_TOKEN={{ buildbox_token }}

env HOME={{ buildbox_home }}
export HOME

env DOCKER_HOST={{ docker_host }}
export DOCKER_HOST

respawn
respawn limit 15 5

start on runlevel [2345]
stop on runlevel [06]

setuid {{ buildbox_user }}
setgid {{ buildbox_group }}

script
  exec $BUILDBOX_HOME/.buildbox/bin/buildbox-agent start --bootstrap-script $BUILDBOX_HOME/.buildbox/bootstrap.sh {% for meta_data in buildbox_meta_data %}--meta-data {{ meta_data }} {% endfor %}--token $BUILDBOX_TOKEN
end script
